{"version":3,"sources":["textures/grass.jpg","App.tsx","serviceWorker.js","index.tsx"],"names":["module","exports","mapDistanceToInternal","distance","grassTexture","TextureLoader","load","grassTextureImg","App","props","townCanvas","animationToken","camera","controls","scene","renderer","React","createRef","Scene","canvas","this","current","context","getContext","canvasBoundingRect","getBoundingClientRect","aspect","width","height","setUpRenderer","document","body","appendChild","VRButton","createButton","res","setupCamera","setupLighting","background","Color","fog","Fog","scale","set","setRegion","tiles","Array","keys","map","num","coordinates","x","y","Math","floor","setAnimationLoop","animate","cancelAnimationFrame","region","forEach","tile","idx","MeshStandardMaterial","color","baseMeshMaterial","MeshPhysicalMaterial","base","Mesh","BoxGeometry","add","translateX","translateZ","update","render","d","OrthographicCamera","OrbitControls","domElement","enableDamping","dampingFactor","screenSpacePanning","minDistance","maxDistance","maxPolarAngle","PI","autoRotate","autoRotateSpeed","position","lookAt","WebGLRenderer","setPixelRatio","setSize","xr","enabled","light","HemisphereLight","dirLight","DirectionalLight","multiplyScalar","setX","ref","className","Component","Boolean","window","location","hostname","match","ReactDOM","StrictMode","getElementById","navigator","serviceWorker","ready","then","registration","unregister","catch","error","console","message"],"mappings":"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","file":"static/js/main.0902d1e5.chunk.js","sourcesContent":["module.exports = __webpack_public_path__ + \"static/media/grass.ff3d3727.jpg\";","import React from \"react\";\nimport {\n  Scene,\n  WebGLRenderer,\n  OrthographicCamera,\n  HemisphereLight,\n  DirectionalLight,\n  Color,\n  Fog,\n  MeshStandardMaterial,\n  MeshPhysicalMaterial,\n  BoxGeometry,\n  TextureLoader,\n} from \"three\";\nimport { OrbitControls } from \"three/examples/jsm/controls/OrbitControls.js\";\nimport { VRButton } from \"three/examples/jsm/webxr/VRButton.js\";\nimport \"./App.scss\";\nimport grassTextureImg from \"./textures/grass.jpg\";\nimport { Mesh } from \"three/src/objects/Mesh\";\n\nconst TileDiameter = 3;\nconst TileGap = 0.2;\nconst TilePadding = 0.4;\nconst BuildingHeight = 1 / 30;\n\nconst mapDistanceToInternal = (distance: number) => {\n  return (TileDiameter + TileGap) * distance;\n};\n\nconst grassTexture = new TextureLoader().load(grassTextureImg);\n\nclass App extends React.Component<{}> {\n  townCanvas: React.RefObject<HTMLCanvasElement>;\n  animationToken?: number;\n  camera: any;\n  controls: any;\n  scene: Scene;\n  renderer: any;\n\n  constructor(props: {}) {\n    super(props);\n    this.townCanvas = React.createRef();\n    this.scene = new Scene();\n  }\n\n  componentDidMount() {\n    const canvas = this.townCanvas.current;\n    const context = canvas?.getContext(\"webgl2\");\n    if (!canvas || !context) {\n      return;\n    }\n    const canvasBoundingRect = canvas.getBoundingClientRect();\n    const aspect = canvasBoundingRect.width / canvasBoundingRect.height;\n    const d = 20;\n\n    this.renderer = this.setUpRenderer(\n      canvas,\n      context,\n      canvasBoundingRect\n    ).renderer;\n    document.body.appendChild(VRButton.createButton(this.renderer));\n    const res = this.setupCamera(aspect, d, this.scene, this.renderer);\n    this.camera = res.camera;\n    this.controls = res.controls;\n    this.setupLighting(this.scene);\n    this.scene.background = new Color(\"#87CEEB\");\n    this.scene.fog = new Fog(0xffffff, 0, 200);\n    this.scene.scale.set(0.5, 0.5, 0.5);\n\n    this.setRegion({\n      tiles: [...Array(16 * 16).keys()].map((num) => ({\n        coordinates: {\n          x: (num % 16) - 16 / 2,\n          y: Math.floor(num / 16) - 16 / 2,\n        },\n      })),\n    });\n    this.renderer.setAnimationLoop(() => this.animate());\n  }\n\n  componentWillUnmount() {\n    if (this.animationToken) {\n      cancelAnimationFrame(this.animationToken);\n    }\n  }\n\n  setRegion(region: any) {\n    region.tiles.forEach((tile: any, idx: number) => {\n      const material = new MeshStandardMaterial({\n        color: \"#eeeeee\",\n      });\n      /*\n      if (tile.population) {\n        const height = mapPopulationToDensity(tile.population, tile.zone);\n        let cube;\n        let geometry;\n        if (tile.zone == Zone.Commercial && height > 5) {\n          let heightCut = (0.5 + Math.random() / 2) * height;\n          geometry = new BoxGeometry(\n            TileDiameter - TilePadding * 2,\n            heightCut + 0.1,\n            TileDiameter - TilePadding * 2\n          );\n          cube = new Mesh(geometry, material);\n          let geometryC = new BoxGeometry(\n            TileDiameter - TilePadding * 4,\n            height - heightCut + 0.1,\n            TileDiameter - TilePadding * 4,\n          );\n          let cubeC = new Mesh(geometryC, material);\n          scene.add(cubeC);\n          active.push(cubeC);\n          cubeC.translateX(mapDistanceToInternal(tile.coordinates.x));\n          cubeC.translateZ(mapDistanceToInternal(tile.coordinates.y));\n          cubeC.translateY((height - heightCut) / 2 + heightCut);\n  \n          scene.add(cube);\n          active.push(cube);\n          cube.translateX(mapDistanceToInternal(tile.coordinates.x));\n          cube.translateZ(mapDistanceToInternal(tile.coordinates.y));\n          cube.translateY(heightCut / 2);\n        } else {\n          const geometry = new BoxGeometry(\n            TileDiameter - TilePadding * 2,\n            height + 0.1,\n            TileDiameter - TilePadding * 2\n          );\n          cube = new Mesh(geometry, material);\n  \n          scene.add(cube);\n          active.push(cube);\n          cube.translateX(mapDistanceToInternal(tile.coordinates.x));\n          cube.translateZ(mapDistanceToInternal(tile.coordinates.y));\n          cube.translateY(height / 2);\n        }\n      } */\n      // Add the base for the tile\n      const baseMeshMaterial = new MeshPhysicalMaterial({\n        map: grassTexture,\n      });\n      const base = new Mesh(\n        new BoxGeometry(TileDiameter, 0.1, TileDiameter),\n        baseMeshMaterial\n      );\n      this.scene.add(base);\n      // active.push(base);\n      base.translateX(mapDistanceToInternal(tile.coordinates.x));\n      base.translateZ(mapDistanceToInternal(tile.coordinates.y));\n    });\n  }\n\n  animate(): void {\n    this.controls.update();\n    this.renderer.render(this.scene, this.camera);\n  }\n\n  setupCamera(\n    aspect: number,\n    d: number,\n    scene: Scene,\n    renderer: any\n  ): { camera: any; controls: any } {\n    const camera = new OrthographicCamera(\n      -d * aspect,\n      d * aspect,\n      d,\n      -d,\n      1,\n      1000\n    );\n    const controls = new OrbitControls(camera, renderer.domElement);\n    controls.enableDamping = true; // an animation loop is required when either damping or auto-rotation are enabled\n    controls.dampingFactor = 0.005;\n    controls.screenSpacePanning = false;\n    controls.minDistance = 100;\n    controls.maxDistance = 500;\n    controls.maxPolarAngle = Math.PI / 2;\n    controls.autoRotate = true;\n    controls.autoRotateSpeed = 0.5;\n\n    camera.position.set(50, 50, 50);\n    camera.lookAt(scene.position);\n    controls.update();\n\n    return {\n      camera,\n      controls,\n    };\n  }\n\n  setUpRenderer(\n    canvas: HTMLCanvasElement,\n    context: WebGL2RenderingContext,\n    canvasBoundingRect: DOMRect\n  ): { renderer: any } {\n    const renderer = new WebGLRenderer({\n      canvas,\n      context,\n    });\n\n    // Fix for retina\n    renderer.setPixelRatio(2);\n\n    renderer.setSize(canvasBoundingRect.width, canvasBoundingRect.height);\n    renderer.xr.enabled = true;\n\n    return {\n      renderer,\n    };\n  }\n\n  setupLighting(scene: Scene) {\n    const sunlight = 0xffffff;\n    var light = new HemisphereLight(sunlight, sunlight, 1);\n    scene.add(light);\n\n    var dirLight = new DirectionalLight(sunlight, 0.5);\n    dirLight.position.multiplyScalar(500);\n    dirLight.position.setX(150);\n    scene.add(dirLight);\n  }\n\n  render() {\n    return <canvas ref={this.townCanvas} className=\"TownCanvas\"></canvas>;\n  }\n}\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' },\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport \"./index.scss\";\nimport App from \"./App\";\nimport * as serviceWorker from \"./serviceWorker\";\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById(\"root\")\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}